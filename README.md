# iothub-ro

Install steps for each landscape : [here](INSTALL.md)

# Architecture Hierarchy

 - Landscapes (example : shared1, string used in hostname for routing only)
 - Tenants (example : myaccount, TENANT_ID is GUID)
 - Projects (example : vehicle-tracking, PROJECT_ID is GUID)
 - Device groups (example : buses, DEVICE_GROUP_ID is GUID)
 - Devices (DEVICE_ID is GUID)

# Technologies Used

Data Ingestion - Node.js REST API -> Kafka Broker

Hot Store - Mongo DB (TO DO in version 0.1)

Cold Store - Hadoop HDFS (TO DO in version 0.2)

Event Processing - Node.js app that checks (TO DO in version 0.3)

Frontend web app - UI5

Backend APIs for front end - Node.js REST

# Kafka Topics (for each Project specific to a Tenant of a Landscape)

1. <PROJECT_ID>_device_raw_data (data sent to a Node.js REST api)
2. <PROJECT_ID>_to_cold_store (generated by an Node.js app based on device_raw_data - if events processing is active)
3. <PROJECT_ID>_to_event_processing (generated by an Node.js app based on device_raw_data - if events processing is active)

All topics with only 1 partition : partition 0 !

# Implementation details

Landscape = each instance of the hub

Components of each Landscape :

  - Ingestion (raw data, events, locations) : Kafka topic + node.js app to handle each topic and raise events
  - Transfer to hotstore (Mongo DB) + Transfer to coldstore (if activated - Hadoop)
  - Hub UI Admin (ui5 app)
  - Hub UI Analytics (later on)
  - REST API for data and entities admin (node.js)
  
Conventions :

  - Landscape URI : http://<LANDSCAPE_NAME>.iothub.ro (example : http://shared1.iothub.ro)
  - Tenant URI : http://<LANDSCAPE_NAME>.iothub.ro/<TENANT_NAME> (example : http://shared1.iothub.ro/myaccount)
  - Project URI : http://<LANDSCAPE_NAME>.iothub.ro/<TENANT_NAME> (example : http://shared1.iothub.ro/myaccount/vehicle-tracking)
  - Group URI : http://<LANDSCAPE_NAME>.iothub.ro/<TENANT_NAME> (example : http://shared1.iothub.ro/myaccount/vehicle-tracking/buses)
  - Device URI : http://<LANDSCAPE_NAME>.iothub.ro/<TENANT_NAME> (example : http://shared1.iothub.ro/myaccount/vehicle-tracking/buses/<DEVICE_ID>)
  
  - Tenants has different Mongo DBs with name : <TENANT_NAME>_tenant
  - Tenants have different Hadoop folders and files : 
  
      /<LANDSCAPE_NAME>/<TENANT_NAME>/<PROJECT_GUID>/<GROUP_GUID>/<DEVICE_GUID>/rawdata.csv
      /<LANDSCAPE_NAME>/<TENANT_NAME>/<PROJECT_GUID>/<GROUP_GUID>/<DEVICE_GUID>/events.csv
      /<LANDSCAPE_NAME>/<TENANT_NAME>/<PROJECT_GUID>/<GROUP_GUID>/<DEVICE_GUID>/locations.csv
  
  - projects, groups, devices, locations, events, rawdata are entities stored in different tables
